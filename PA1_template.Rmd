---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

The following libraries were used in this effort.

```{r load_libs}
options(scipen=1, digits=2)
require(dplyr)
require(ggplot2)
require(lubridate)
require(reshape2)
```

## Loading and preprocessing the data

The following code loads and provides the initial processing of the data. The analyses required for this project need various alternative data structures, These alternatives are build here.

```{r}
if(!file.exists("./data")) {dir.create("./data")}
unzip("activity.zip", exdir="./data")
# base data set with date column converted to date type
df <- read.csv("./data/activity.csv") 
df$date <- ymd(df$date)

# count by date
dte_df <- df %>% group_by(date) %>% summarise(steps = sum(steps))

# average steps by interval
intv_df <- df %>% group_by(interval) %>% summarise(steps = mean(steps, na.rm = TRUE))

# imputed NA data frame
na_df <- df %>% group_by(interval) %>% mutate(mstep = mean(steps, na.rm = TRUE))
na_df$steps <- ifelse(is.na(na_df$steps), na_df$mstep, na_df$steps)
nona_df <- na_df %>% group_by(date) %>% summarise(steps = sum(steps))

# Weekend factor added to base data frame
wk_df <- na_df %>%
    mutate(weekend = ifelse(weekdays(date, abbreviate = TRUE) %in% c("Sun","Sat"), 
                            "weekend",
                            "weekday"))
wk_df$weekend <- as.factor(wk_df$weekend)
wk_df <- wk_df %>% group_by(weekend, interval) %>% summarise(steps = mean(steps, na.rm = TRUE))
```

## What is mean total number of steps taken per day?

The distribution of the mean total number of steps per day is shown in the histogram below.

```{r daily_steps, warning=FALSE}
g1 <- ggplot(dte_df, aes(x = date, y = steps)) +
    geom_histogram(stat = "identity", fill = "red", colour = "red") +
    ggtitle("Mean Total Number of Steps per Day") +
    xlab("Date") +
    ylab("Number of Steps")
print(g1)
mn <- mean(dte_df$steps, na.rm = TRUE)
md <- median(dte_df$steps, na.rm = TRUE)
```

The analysis of the total number of steps per day showed the **mean** to be `r mn` and the **median** to be `r md`.

## What is the average daily activity pattern?

The following is a time series plot of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis).

```{r interval_steps}
g2 <- ggplot(intv_df, aes(x = interval, y = steps)) +
    geom_line(stat = "identity", colour = "red", size = 1) +
    ggtitle("Average Number of Steps per Interval") +
    xlab("Interval") +
    ylab("Number of Steps")
print(g2)
mx <- intv_df %>% arrange(desc(steps)) %>% top_n(1) %>% select(interval)
```
Interval `r mx` had the highest mean for number of steps.

## Imputing missing values

```{r naCount}
na_cnt <- sum(is.na(df$steps))
```

There are `r na_cnt` intervals with no steps recorded. When these are replaced with the overall mean for that interval, the following is seen.

```{r withNoNa}
g3 <- ggplot(nona_df, aes(x = date, y = steps)) +
    geom_histogram(stat = "identity", fill = "red", colour = "red") +
    ggtitle("Mean Total Number of Steps per Day") +
    xlab("Date") +
    ylab("Number of Steps")
print(g3)
na_mn <- mean(nona_df$steps)
na_md <- median(nona_df$steps)
```
The analysis of the total number of steps per day with imputed values for NA showed the **mean** to be `r na_mn` and the **median** to be `r na_md`.


## Are there differences in activity patterns between weekdays and weekends?


```{r}
g4 <- ggplot(wk_df, aes(x = interval, y = steps)) +
    geom_line(stat = "identity", colour = "red", size = 1) +
    facet_grid(weekend ~ .) +
    ggtitle("Average Number of Steps per Interval") +
    xlab("Interval") +
    ylab("Number of Steps")
print(g4)


```
